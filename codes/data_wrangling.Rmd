---
title: "Untitled"
author: "Chenjia"
date: "2024-03-28"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
library(lubridate)
library(dplyr)
library(forecast) 
```
```{r}
load <- load_raw %>%
  mutate(date = ymd(date)) %>%
  mutate(daily_mean = rowMeans(select(., 3:26), na.rm = TRUE)) %>%
  filter(!is.na(daily_mean)) %>%
  select(meter_id,date,daily_mean)
```

```{r}
#Creating time series
ts_load <- msts(load$daily_mean, 
                           seasonal.periods =c(7,365.25),
                           start=c(2005,01,01))

ts_load_training <- subset(ts_load,end = length(ts_load)-30)
ts_load_testing <- subset(ts_load,start = length(ts_load)-30)

ts_load_training %>% mstl() %>%
  autoplot()
```

```{r}
# TBATS model
TBATS_fit <- tbats(ts_load_training)

TBATS_forcast <- forecast(TBATS_fit, h=30)

autoplot(TBATS_forcast)
autoplot(ts_load_testing) +
  autolayer(TBATS_forcast, series="TBATS",PI=FALSE)

TBATS_scores <- accuracy(TBATS_forcast$mean,ts_load_testing)
print(TBATS_scores)
```

